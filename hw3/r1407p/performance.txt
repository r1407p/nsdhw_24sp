sources = matrix.cpp
tests = test_matrix.py
executable = matrix$(shell python3-config --extension-suffix)

CXX = g++
CXXFLAGS = -std=c++14 -O3 -Wall -shared -fPIC `python3 -m pybind11 --includes` `python3-config --includes --ldflags`

all: $(sources)
	$(CXX) $(CXXFLAGS) $(shell python3 -m pybind11 --includes) $(sources) -o $(executable)

test:
	python3 -m $(tests)

clean:
	rm -rf $(executable) __pycache__ .pytest* *.so